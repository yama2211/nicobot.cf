
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
<meta name="referrer" content="origin"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<link rel="stylesheet" type="text/css" href="./css/bootstrap.css">
<link rel="stylesheet" type="text/css" href="./css/style.css">
<link rel="stylesheet" type="text/css" href="./css/font-awesome.css">
<link rel="stylesheet" type="text/css" href="./css/doc.css">
<link rel="stylesheet" type="text/css" href="./css/bootstrap-social.css">
<title>毎時ランキング-NicoBot</title>

<script type="text/JavaScript" src="./js/jquery.min.js"></script>
<script type="text/javascript">
$(function() {
    var setURL = 'http://www.nicovideo.jp/ranking/fav/hourly/all?rss=2.0&lang=ja-jp'; //feedのURL
    var setNUM = 10; //表示件数
    var setID = 'eh'; //表示させる箇所のID
    xmlLoad(setURL,setID,setNUM);
});
function xmlLoad(_xmlUrl,_id,_num){
    DD = new Date();HH = DD.getHours();MM = DD.getMinutes();SS = DD.getSeconds();
    var xmlUrl = _xmlUrl+"?"+HH+MM+SS;  //キャッシュ対策のクエリを付与
    var main = this;
    $.ajax({
    url: xmlUrl,
    type: 'GET',
    dataType: 'xml',
    timeout: 10000,
    error: function(){
        _msg = 'error';
        xmlOpen(_msg,_id,_num);
    },
    success: function(_xml){
        main.xml = _xml;
        _msg = 'load';
        xmlOpen(_msg,_id,_num);
    }
    });
    return;
}
var xmlOpen = function(_msg,_id,_num){
    var main = this;
    var html = '';
    var ID = _id;
    var Num = _num;
    if(_msg == 'load'){
        xml = main.xml;
        var channelData = $(xml).find('channel')[0];
        $(channelData).find('item').each(function(i){
            if(i < Num){
            postTitle = $(this).find('title').text();//記事タイトル取得
            postLink = $(this).find('link').text();//記事リンク取得
             
            //日付を取得し年月日を整形
            publishedDate = $(this).find('pubDate').text();
            var pubDD = new Date(publishedDate);
            yy = pubDD.getYear();if (yy < 2000) { yy += 1900; }
            mm = pubDD.getMonth() + 1;dd = pubDD.getDate();
            var postDate = yy +'年'+ mm +'月'+ dd +'日';
             
            //カテゴリが１記事に複数あるのである分だけ取得
            var postCategory = '';
            $(this).find('category').each(function(i){
                category = $(this).text();
                if(i <= 0){
                    postCategory += category;
                }else{
                    postCategory += ',' + category;
                }           
            });
             
            //表示する部分を整形
            html += '<li><a href="' + postLink + '">' + postTitle +'</a> - ' + postCategory + '（' + postDate + '）</li>';
            }
        });     
    }else{
        html += '<li>通信エラー</li>';
    }
    $("#"+ID).html(html);
}
</script>

</head>
<body>
<div class="container">
<div class="jumbotron">
  <div class="row">

  <div class="col-md-8">
<ol class="breadcrumb">
  <li class="active"><span class="glyphicon glyphicon-home"></span> ホーム</li>
</ol>
<h1>毎時ランキング <small>RSSから取得</small></h1>
<p>10位までを表示します。</p>

<hr>
<div class="copy">&copy; 2016-2017 Nicobot<br>NicoNicoは「<a href="http://dwango.co.jp/">株式会社ドワンゴ</a>」が運営しています。<br><b>当サイト及びTwitterBotは有志により運営されています。</b></div>
  </div><!--col-xs-9-->

    <div class="col-md-4">

  <div class="panel panel-default">
  <div class="panel-heading">ツイート</div>
  <div class="panel-body">
    <a href="./tweet.html">長くなる為別のページに</a>
  </div>
</div>
  </div>
  </div><!--row-->
  </div><!--jumbotron-->
  </div><!--container-->
<script src="./js/jquery.min.js"></script>
<script src="./js/bootstrap.js"></script>
</body>
</html>
